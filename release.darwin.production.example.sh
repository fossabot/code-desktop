# Cleanup files
rm -rf node_modules
rm -rf src/ui
rm -rf dist

# Install and build
npm install --only=production
npm run move-ui-production

# Bundle
export NODE_ENV=production
npm run bundle

# Sign
export APPLE_DEVELOPER_IDENTITY="????????????????????????????????????????" # $ security find-identity -v -p codesigning
npm run sign

# Package
export APPLE_DEVELOPER_USERNAME="?????@??????.?????" # personal developer email
export APPLE_DEVELOPER_PASSWORD="????-????-????-????" # app password generated at https://appleid.apple.com/account/manage
export APPLE_DEVELOPER_PROVIDER="??????????" # $  xcrun altool --username "?????@??????.?????" --password "????-????-????-????" --list-providers
export NODE_ENV=production
npm run package:notarize

# Publish
export S3_KEY="???????????????????"
export S3_SECRET="??????????????????????????????????"
export S3_BUCKET="strawbees-downloads-production"
npm run publish
